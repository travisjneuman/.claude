#!/usr/bin/env bash
# SessionStart hook - Injects router protocol and Ultrathink directive
# This ensures every session automatically benefits from the full skill/agent ecosystem

cat << 'EOF'
{
  "hookSpecificOutput": {
    "hookEventName": "SessionStart",
    "additionalContext": "## AUTOMATIC EXECUTION PROTOCOL (Always Active)\n\n### ULTRATHINK MODE: ENABLED\nApply maximum reasoning depth for ALL non-trivial tasks. Skip extended thinking ONLY for: typos, single-line fixes, simple factual answers.\n\n### AUTOMATIC ROUTING PROTOCOL\nFor EVERY task (not just /start-task), you MUST:\n\n1. **Detect Domains** from the prompt:\n   - ios/swift/apple → `Skill(ios-development)` + `ios-developer` agent\n   - android/kotlin → `Skill(android-development)` + `android-developer` agent\n   - react/frontend/jsx → `Skill(generic-react-feature-developer)` + `react-expert` agent\n   - vue/nuxt/pinia → `Skill(vue-development)`\n   - svelte/sveltekit → `Skill(svelte-development)`\n   - api/backend/rest → `Skill(api-design)` + `api-designer` agent\n   - database/sql/prisma → `Skill(database-expert)` + `database-architect` agent\n   - devops/docker/k8s → `Skill(devops-cloud)` + `devops-engineer` agent\n   - test/testing/tdd → `Skill(test-specialist)` + `test-generator` agent\n   - security/auth/oauth → `Skill(security)` + `security-auditor` agent\n   - debug/bug/fix/error → `Skill(debug-systematic)` + `debugging-specialist` agent\n   - graphql/schema → `Skill(graphql-expert)` + `graphql-architect` agent\n   - microservice/distributed → `Skill(microservices-architecture)` + `microservices-architect` agent\n   - ai/ml/llm/pytorch → `Skill(ai-ml-development)` + `ml-engineer` agent\n   - game/unity/godot → `Skill(game-development)` + `game-developer` agent\n   - ui/design/styling → Load `docs/reference/checklists/ui-visual-changes.md` + `Skill(frontend-enhancer)`\n   - startup/launch → `Skill(startup-launch)` + `startup-advisor` agent\n   - pricing/monetization → `Skill(monetization-strategy)` + `monetization-expert` agent\n\n2. **Auto-Load Contextual Rules:**\n   - UI/visual work → `docs/reference/checklists/ui-visual-changes.md`\n   - Scripts/automation → `docs/reference/checklists/automation-scripts.md`\n   - Task completion → `rules/checklists/verification-template.md`\n   - Research tasks → `docs/reference/workflows/research-methodology.md`\n\n3. **Invoke Skills IMMEDIATELY** when detected (even 1% chance):\n   - Use `Skill(name)` tool - DO NOT just mention skills, INVOKE them\n   - Skills provide domain expertise that improves output quality\n\n4. **Spawn Agents** for specialized work:\n   - Use `Task` tool with appropriate `subagent_type`\n   - Agents run autonomously and return results\n\n5. **Research Triggers** (use WebSearch):\n   - 'latest', 'current', 'recent', '2025', '2026'\n   - 'best way to', 'recommended', 'is there a library'\n   - Version queries ('React 19', 'Node 22')\n\n### CRITICAL REMINDERS\n- **Skills exist to be USED** - invoke them, don't just acknowledge them\n- **This protocol applies to ALL prompts** - not just /start-task\n- **Proactive > Reactive** - detect and load resources before the user asks\n- **TodoWrite for 3+ steps** - track progress on multi-step tasks\n- **Verify before complete** - always check verification-template.md\n\n### Quick Domain Reference\n| Keywords | Skill | Agent |\n|----------|-------|-------|\n| react, frontend, component | generic-react-feature-developer | react-expert |\n| ios, swift, swiftui | ios-development | ios-developer |\n| android, kotlin, compose | android-development | android-developer |\n| api, backend, rest | api-design | api-designer |\n| database, sql, postgres | database-expert | database-architect |\n| test, testing, coverage | test-specialist | test-generator |\n| security, auth, vulnerability | security | security-auditor |\n| debug, bug, error, fix | debug-systematic | debugging-specialist |\n| devops, docker, k8s, aws | devops-cloud | devops-engineer |\n| design, ui, styling, css | frontend-enhancer | - |\n| startup, launch, mvp | startup-launch | startup-advisor |\n\n**Protocol Status: ACTIVE - Execute on every prompt**"
  }
}
EOF

exit 0
