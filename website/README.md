# tjn.claude/ Website

Showcase website for the `.claude` configuration framework.

**Live:** https://claude.travisjneuman.com

## Stack

- **Framework:** Next.js 16 (App Router, static export)
- **Hosting:** Cloudflare Pages (GitHub integration, auto-deploy on push)
- **Build output:** Static HTML (`output: "export"` in `next.config.ts`)

## Development

```bash
cd website
npm install
npm run dev
```

Open http://localhost:3000.

## Build

```bash
npm run build
```

Output goes to `website/out/` as static files.

## Deployment

Deployed via **GitHub > Cloudflare Pages** pipeline:

1. Push to `master` triggers Cloudflare Pages build
2. Cloudflare clones the repo (submodules are **not** initialized)
3. Build runs `npm run build` inside `website/`
4. Static output (`out/`) is deployed to the CDN

### Important: Marketplace data fallback

Because Cloudflare Pages doesn't initialize git submodules, the `plugins/marketplaces/` directory is empty at build time. The website uses a fallback mechanism:

- **Local builds:** `getMarketplaceStats()` reads live data from `../plugins/marketplaces/`
- **Cloudflare builds:** Falls back to `src/lib/data/marketplace-counts.json` (pre-generated)

The fallback JSON is regenerated by `scripts/update-counts.sh` (run via `/update-counts` or `_pull-all-repos.sh`). After adding/removing marketplace repos, run the update script and commit the new JSON.

### Cloudflare Pages configuration

| Setting | Value |
| --- | --- |
| Production branch | `master` |
| Build command | `cd website && npm install && npm run build` |
| Build output directory | `website/out` |
| Root directory | `/` |

## Data sources

| Data | Source | Fallback |
| --- | --- | --- |
| Skills | `../skills/` (in repo, always available) | None needed |
| Agents | `../agents/` (in repo, always available) | None needed |
| Scripts | `../scripts/`, `../scripts/hooks/`, `../_pull-all-repos.sh` | None needed |
| Marketplace repos | `../plugins/marketplaces/` (submodules) | `marketplace-counts.json` |

## Updating counts

When marketplace repos change, regenerate the fallback data:

```bash
bash ~/.claude/scripts/update-counts.sh
```

This updates hardcoded counts across all documentation AND regenerates `marketplace-counts.json`.

## Architecture Notes

### Prebuild Script

`scripts/fix-submodules.mjs` runs automatically before `next build` via npm lifecycle hooks (`prebuild` in `package.json`). It removes the specific broken `axiom` gitlink inside `claude-code-plugins-plus-skills/plugins/skill-enhancers/` that causes Cloudflare Pages' recursive clone to fail. The script targets only this single dangling gitlink (not the entire `plugins/` directory), so legitimate skill files are preserved. It is a safe no-op when the gitlink doesn't exist.

### Scripts Data Layer

`src/lib/data/scripts.ts` follows the hooks.ts pattern — a `SCRIPT_METADATA` record maps each script slug to its name, category, description, and "when to run" text. The `getScripts()` function reads `.sh` and `.ps1` files from `../scripts/`, `../scripts/hooks/`, and `../_pull-all-repos.sh`, wraps raw content in markdown code blocks, and converts to HTML with remark. Scripts are grouped by category on the `/scripts` page and summarized on the homepage.

### Dynamic Counts

`src/lib/data/counts.ts` is the single source of truth for all formatted count strings displayed on the website. The `getCounts()` function calls `getSkills()`, `getAgents()`, and `getMarketplaceStats()` at build time and returns pre-formatted strings (e.g., "89+", "47", "3,900+"). These strings are consumed by metadata in `layout.tsx`, the footer, and the console greeting. This eliminates count drift between different website sections — there is no hardcoded count anywhere in the UI layer.

### Component Props

- **ConsoleGreeting** accepts a `stats` prop with formatted count strings for the ASCII art greeting.
- **Footer** accepts a `counts` prop for displaying skill/agent/marketplace totals.
- **FooterWithDocs** passes counts from `getCounts()` into Footer.
- **layout.tsx** uses `getCounts()` to populate metadata descriptions.
